#!/usr/bin/env python

import json
import unittest
import requests
import os
if os.name == 'nt':
    class timeout_decorator:
        @staticmethod
        def timeout(*args, **kwargs):
            return lambda f: f # return a no-op decorator
else:
    import timeout_decorator
from em_test_utils import *


#  This file was automatically generated by EvoMaster on 2024-10-06T15:07:23.569-03:00[America/Argentina/Buenos_Aires]
#  
#  The generated test suite contains 1 tests
#  
#  Covered targets: 3
#  
#  Used time: 0h 10m 56s
#  
#  Needed budget for current results: 63%
#  
#  This file contains test cases that are likely to indicate faults.
class EvoMaster_faults_Test(unittest.TestCase):

    
    baseUrlOfSut = "http://localhost:8080"
    
    
    
    
    
    
    
    
    
    
    # Individual:
    # 	Actions:
    # 		org.evomaster.core.problem.rest.RestCallAction: POST:/news
    # 			Action parameters:
    # 				body: '{"authorId":"lXbsoTT2uw", "country":"_vgnYgMkH5zZX5jC", "text":"pqUJgqLqGU"}'
    # 			Genes:
    # 				org.evomaster.core.search.gene.optional.OptionalGene = body:{"authorId":"lXbsoTT2uw", "country":"_vgnYgMkH5zZX5jC", "text":"pqUJgqLqGU"}
    # 				org.evomaster.core.search.gene.collection.EnumGene = contentType:application/vnd.tsdes.news+json;charset=UTF-8;version=2
    # 				org.evomaster.core.search.gene.optional.CustomMutationRateGene = sendUnquoteJsonString:false
    # 	Evaluated Actions:
    # 		org.evomaster.core.problem.rest.RestCallAction: POST:/news
    @timeout_decorator.timeout(60)
    def test_0_POST_on_news_causes500_internalServerError(self):
        
        # Fault100. HTTP Status 500. POST:/news
        headers = {}
        headers["content-type"] = "application/vnd.tsdes.news+json;charset=UTF-8;version=2"
        body = {}
        body = " { " + \
            " \"authorId\": \"lXbsoTT2uw\", " + \
            " \"country\": \"_vgnYgMkH5zZX5jC\", " + \
            " \"text\": \"pqUJgqLqGU\" " + \
            " } "
        headers['Accept'] = "application/vnd.tsdes.news+json;charset=UTF-8;version=2"
        res_0 = requests \
                .post(self.baseUrlOfSut + "/news",
                    headers=headers, data=body)
        
        assert res_0.status_code == 500
        assert "application/vnd.tsdes.news+json" in res_0.headers["content-type"]
        assert res_0.json()["status"] == 500.0
        assert res_0.json()["error"] == "Internal Server Error"
        assert res_0.json()["message"] == "Could not commit JPA transaction; nested exception is javax.persistence.RollbackException: Error while committing the transaction"
        assert res_0.json()["path"] == "/news"


if __name__ == '__main__':
    unittest.main()
